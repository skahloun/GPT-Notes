<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PayPal Debug Test</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        .debug-container {
            max-width: 800px;
            margin: 2rem auto;
            padding: 2rem;
        }
        .log-entry {
            margin: 0.5rem 0;
            padding: 0.5rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 4px;
            font-family: monospace;
            font-size: 0.875rem;
        }
        .log-entry.error {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.3);
        }
        .log-entry.success {
            background: rgba(16, 185, 129, 0.1);
            border: 1px solid rgba(16, 185, 129, 0.3);
        }
        .test-section {
            margin: 2rem 0;
            padding: 1.5rem;
            background: var(--surface-glass);
            border-radius: var(--radius-lg);
        }
    </style>
</head>
<body>
    <div class="debug-container">
        <h1>PayPal Debug Test</h1>
        <p>This page tests the PayPal integration step by step.</p>
        
        <div class="test-section">
            <h2>Test Configuration</h2>
            <div id="config-info"></div>
        </div>
        
        <div class="test-section">
            <h2>Simple $1 Test Payment</h2>
            <button id="test-payment" class="btn btn-primary">Test $1 Payment</button>
            <div id="paypal-test-container" style="margin-top: 1rem;"></div>
        </div>
        
        <div class="test-section">
            <h2>Debug Log</h2>
            <div id="debug-log"></div>
        </div>
        
        <div style="text-align: center; margin-top: 2rem;">
            <a href="/pricing.html" class="btn btn-secondary">Back to Pricing</a>
        </div>
    </div>

    <!-- PayPal SDK -->
    <script src="https://www.paypal.com/sdk/js?client-id=AbIwl5_VLf_ZH2OizJ7rvFQOT70CVT9GCLy8eFFUvHUb8ITUmAhlBix05nEL8reiXiJn-hDGei9uhvjj&currency=USD&intent=capture&disable-funding=credit,card&debug=true"></script>
    
    <script>
        const log = (message, type = 'info') => {
            const logDiv = document.getElementById('debug-log');
            const entry = document.createElement('div');
            entry.className = `log-entry ${type}`;
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            logDiv.appendChild(entry);
            console.log(message);
        };
        
        // Display configuration
        document.getElementById('config-info').innerHTML = `
            <p><strong>Client ID:</strong> ${window.location.href.includes('localhost') ? 'LOCAL' : 'PRODUCTION'}</p>
            <p><strong>PayPal SDK Loaded:</strong> <span id="sdk-status">Checking...</span></p>
            <p><strong>Auth Token:</strong> ${localStorage.getItem('authToken') ? 'Present' : 'Missing'}</p>
        `;
        
        // Check PayPal SDK
        window.addEventListener('load', () => {
            setTimeout(() => {
                if (typeof paypal !== 'undefined') {
                    document.getElementById('sdk-status').innerHTML = '<span style="color: #10b981;">✓ Loaded</span>';
                    log('PayPal SDK loaded successfully', 'success');
                } else {
                    document.getElementById('sdk-status').innerHTML = '<span style="color: #ef4444;">✗ Failed</span>';
                    log('PayPal SDK failed to load', 'error');
                }
            }, 1000);
        });
        
        // Test payment button
        document.getElementById('test-payment').addEventListener('click', () => {
            log('Initializing test payment...');
            
            const container = document.getElementById('paypal-test-container');
            container.innerHTML = '';
            
            try {
                paypal.Buttons({
                    createOrder: function(data, actions) {
                        log('Creating order...');
                        return actions.order.create({
                            purchase_units: [{
                                amount: {
                                    value: '1.00'
                                },
                                description: 'Test Payment'
                            }]
                        }).then(orderId => {
                            log(`Order created successfully: ${orderId}`, 'success');
                            return orderId;
                        }).catch(err => {
                            log(`Error creating order: ${err.message}`, 'error');
                            console.error('Full error:', err);
                            throw err;
                        });
                    },
                    onApprove: function(data, actions) {
                        log(`Payment approved! Order ID: ${data.orderID}`);
                        return actions.order.capture().then(function(details) {
                            log(`Payment captured! Transaction ID: ${details.id}`, 'success');
                            log(`Payer: ${details.payer.email_address}`, 'success');
                            alert('Test payment successful!');
                        }).catch(err => {
                            log(`Error capturing payment: ${err.message}`, 'error');
                            console.error('Full error:', err);
                        });
                    },
                    onError: function(err) {
                        log(`PayPal error: ${err.message || err}`, 'error');
                        console.error('Full PayPal error:', err);
                    },
                    onCancel: function(data) {
                        log('Payment cancelled by user');
                    }
                }).render('#paypal-test-container').then(() => {
                    log('PayPal button rendered successfully', 'success');
                }).catch(err => {
                    log(`Error rendering PayPal button: ${err.message}`, 'error');
                    console.error('Full render error:', err);
                });
            } catch (err) {
                log(`Fatal error: ${err.message}`, 'error');
                console.error('Full error:', err);
            }
        });
    </script>
</body>
</html>